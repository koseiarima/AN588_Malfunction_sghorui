<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Soumalya">

<title>sghorui_OriginalHomeworkCode_04</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="sghorui_OriginalHomeworkCode_04_files/libs/clipboard/clipboard.min.js"></script>
<script src="sghorui_OriginalHomeworkCode_04_files/libs/quarto-html/quarto.js"></script>
<script src="sghorui_OriginalHomeworkCode_04_files/libs/quarto-html/popper.min.js"></script>
<script src="sghorui_OriginalHomeworkCode_04_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="sghorui_OriginalHomeworkCode_04_files/libs/quarto-html/anchor.min.js"></script>
<link href="sghorui_OriginalHomeworkCode_04_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="sghorui_OriginalHomeworkCode_04_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="sghorui_OriginalHomeworkCode_04_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="sghorui_OriginalHomeworkCode_04_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="sghorui_OriginalHomeworkCode_04_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">sghorui_OriginalHomeworkCode_04</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Soumalya </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="whats-your-malfunction" class="level1">
<h1><strong>What‚Äôs Your Malfunction?</strong></h1>
<p>Create a new <em>GitHub</em> repo and git-referenced <em>Rstudio</em> Project called ‚ÄúAN588_Malfunction_BUlogin‚Äù. Within that repo, create a new <code>.Rmd</code> file called ‚ÄúBUlogin_OriginalHomeworkCode_04‚Äù. Don‚Äôt forget to add your <a href="https://fuzzyatelin.github.io/bioanth-stats/peercommentary.html">Peer Group</a> and instructor as collaborators, and to accept their invitations to you. Making sure to push both the markdown and knitted <code>.html</code> files to your repository, do the following:</p>
<p>Here‚Äôs the first question:</p>
<section id="write-a-simple-r-function-z.prop.test-that-can-perform-one--or-two-sample-z-tests-for-proportion-data-using-the-following-guidelines" class="level3">
<h3 class="anchored" data-anchor-id="write-a-simple-r-function-z.prop.test-that-can-perform-one--or-two-sample-z-tests-for-proportion-data-using-the-following-guidelines">[1] Write a simple R function, <code>Z.prop.test()</code>, that can perform one- or two-sample Z-tests for proportion data, using the following guidelines:</h3>
<ul>
<li><p>Your function should take the following arguments: p1 and n1 (no default) representing the estimated proportion and sample size (i.e., based on your sample data); p2 and n2 (both defaulting to NULL) that contain a second sample‚Äôs proportion and sample size data in the event of a two-sample test; p0 (no default) as the expected value for the population proportion; and alternative (default ‚Äútwo.sided‚Äù) and conf.level (default 0.95), to be used in the same way as in the function <code>t.test()</code>.</p></li>
<li><p>When conducting a two-sample test, it should be p1 that is tested as being smaller or larger than p2 when alternative=‚Äúless‚Äù or alternative=‚Äúgreater‚Äù, the same as in the use of x and y in the function <code>t.test()</code>.</p></li>
<li><p>The function should perform a one-sample Z-test using p1, n1, and p0 if either p2 or n2 (or both) is NULL.</p></li>
<li><p>The function should contain a check for the rules of thumb we have talked about (ùëõ‚àóùëù&gt;5n‚àóp&gt;5 and ùëõ‚àó(1‚àíùëù)&gt;5n‚àó(1‚àíp)&gt;5) to ensure the validity of assuming the normal distribution in both the one- and two-sample settings. If this is violated, the function should still complete but it should also print an appropriate warning message.</p></li>
<li><p>The function should return a list containing the members Z (the test statistic), P (the appropriate p value), and CI (the two-sided CI with respect to ‚Äúconf.level‚Äù around p1 in the case of a one-sample test and around p2-p1 in the case of a two-sample test). For all test alternatives (‚Äútwo.sided‚Äù, ‚Äúgreater‚Äù, ‚Äúless‚Äù), calculate symmetric CIs based on quantiles of the normal distribution rather than worrying about calculating single-limit confidence bounds.</p></li>
</ul>
<p>So, let‚Äôs do this!</p>
<p>I will start by defining the function Z.prop.test:</p>
<pre class="{r} eval:false}"><code>Z.prop.test &lt;- function(p1, n1, p2 = NULL, n2 = NULL, p0, alternative = "two.sided", conf.level = 0.95) 
  {
  check_normality &lt;- function(p, n) # this function will check if the sample size is large enough for the normal approximation to work.
    {
    if (n * p &lt; 5 || n * (1 - p) &lt; 5) 
      {
      warning("Normal approximation may not be valid: n*p or n*(1-p) is less than 5.") # Here I am checking the rules of thumb: np &gt; 5 and n(1-p) &gt; 5. If these conditions are not met, it will send the above warning.
    }
  }</code></pre>
</section>
<section id="one-sample-z-test" class="level3">
<h3 class="anchored" data-anchor-id="one-sample-z-test"><strong>One Sample Z-test:</strong></h3>
<p>If I am only testing one sample (i.e., p2 or n2 is NULL), I will perform a one-sample Z-test.</p>
<p>```deq eval:false # One-sample Z-test if (is.null(p2) || is.null(n2)) { # Check if the data is valid check_normality(p1, n1)</p>
<pre><code># Calculate the standard error
se &lt;- sqrt(p0 * (1 - p0) / n1)

# Calculate the Z statistic
Z &lt;- (p1 - p0) / se

# Calculate the p-value based on the alternative hypothesis
if (alternative == "two.sided") 
  {
  P &lt;- 2 * pnorm(-abs(Z))  # Two-tailed test
} 
else if (alternative == "less") 
  {
  P &lt;- pnorm(Z)  # Left-tailed test
} 
else if (alternative == "greater") 
  {
  P &lt;- pnorm(-Z)  # Right-tailed test
} 
else 
  {
  stop("Invalid alternative hypothesis. Use 'two.sided', 'less', or 'greater'.")
}

# Calculate the confidence interval
alpha &lt;- 1 - conf.level
z_alpha &lt;- qnorm(1 - alpha / 2)
CI &lt;- c(p1 - z_alpha * se, p1 + z_alpha * se)</code></pre>
<p>}</p>
<pre><code>
The function starts by checking if the data is valid for a Z-test using a helper function. It calculates the standard error (se), which measures how much the sample proportion (p1) might vary from the true population proportion (p0). Next, it computes the Z statistic, which tells us how far p1 is from p0 in terms of standard errors. The p-value is then calculated to show how likely it is to see a result as extreme as p1 if the true proportion is p0. This depends on the alternative hypothesis: "two-sided" tests if p1 is different from p0 (higher or lower), "less" tests if p1 is less than p0, and "greater" tests if p1 is greater than p0. Finally, the confidence interval (CI) gives a range of values where we‚Äôre fairly confident the true proportion lies.

### Two-Sample Z-Test:

If I am comparing two samples (i.e., both p2 and n2 are provided), we perform a two-sample Z-test.

```{r} eval:false
# Two-sample Z-test
  else 
    {
    # Check if the data is valid for both samples
    check_normality(p1, n1)
    check_normality(p2, n2)
    
    # Calculate the pooled proportion
    pooled_p &lt;- (p1 * n1 + p2 * n2) / (n1 + n2)
    
    # Calculate the standard error
    se &lt;- sqrt(pooled_p * (1 - pooled_p) * (1 / n1 + 1 / n2))
    
    # Calculate the Z statistic
    Z &lt;- (p1 - p2) / se
    
    # Calculate the p-value based on the alternative hypothesis
    if (alternative == "two.sided") 
      {
      P &lt;- 2 * pnorm(-abs(Z))  # Two-tailed test
    } 
    else if (alternative == "less") 
      {
      P &lt;- pnorm(Z)  # Left-tailed test (p1 &lt; p2)
    } 
    else if (alternative == "greater") 
      {
      P &lt;- pnorm(-Z)  # Right-tailed test (p1 &gt; p2)
    } 
    else 
      {
      stop("Invalid alternative hypothesis. Use 'two.sided', 'less', or 'greater'.")
    }
    
    # Calculate the confidence interval for the difference in proportions
    alpha &lt;- 1 - conf.level
    z_alpha &lt;- qnorm(1 - alpha / 2)
    CI &lt;- c((p1 - p2) - z_alpha * se, (p1 - p2) + z_alpha * se)
  }</code></pre>
<p>The function first checks if both samples are valid for a Z-test. It then calculates the <strong>pooled proportion</strong>, which combines the proportions from both samples to estimate a common proportion under the null hypothesis. Next, it computes the <strong>standard error (se)</strong>, which measures how much the difference between p1 and p2 might vary. The <strong>Z statistic</strong> tells us how far p1 is from p2 in terms of standard errors. The <strong>p-value</strong> shows how likely it is to see a difference as extreme as p1-p2 if there‚Äôs no real difference between the groups. Finally, the <strong>confidence interval (CI)</strong> gives a range of values for the difference between p1 and p2.</p>
<p>Now the results:</p>
<p><code>deq eval:false # Return the results as a list   return(list(Z = Z, P = P, CI = CI)) }</code></p>
<p>Now, to run this entire the above code properly, we have to run it as a single chunk.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Z.prop.test <span class="ot">&lt;-</span> <span class="cf">function</span>(p1, n1, <span class="at">p2 =</span> <span class="cn">NULL</span>, <span class="at">n2 =</span> <span class="cn">NULL</span>, p0, <span class="at">alternative =</span> <span class="st">"two.sided"</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>) </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Helper function to check if the normal approximation is valid</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  check_normality <span class="ot">&lt;-</span> <span class="cf">function</span>(p, n) </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (n <span class="sc">*</span> p <span class="sc">&lt;</span> <span class="dv">5</span> <span class="sc">||</span> n <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> p) <span class="sc">&lt;</span> <span class="dv">5</span>) </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">warning</span>(<span class="st">"Normal approximation may not be valid: n*p or n*(1-p) is less than 5."</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># One-sample Z-test</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(p2) <span class="sc">||</span> <span class="fu">is.null</span>(n2)) </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if the data is valid</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">check_normality</span>(p1, n1)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the standard error</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(p0 <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> p0) <span class="sc">/</span> n1)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the Z statistic</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    Z <span class="ot">&lt;-</span> (p1 <span class="sc">-</span> p0) <span class="sc">/</span> se</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the p-value based on the alternative hypothesis</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (alternative <span class="sc">==</span> <span class="st">"two.sided"</span>) </span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>      P <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">abs</span>(Z))  <span class="co"># Two-tailed test</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (alternative <span class="sc">==</span> <span class="st">"less"</span>) </span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>      P <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(Z)  <span class="co"># Left-tailed test</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (alternative <span class="sc">==</span> <span class="st">"greater"</span>) </span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>      P <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span>Z)  <span class="co"># Right-tailed test</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> </span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">"Invalid alternative hypothesis. Use 'two.sided', 'less', or 'greater'."</span>)</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the confidence interval</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    alpha <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> conf.level</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    z_alpha <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    CI <span class="ot">&lt;-</span> <span class="fu">c</span>(p1 <span class="sc">-</span> z_alpha <span class="sc">*</span> se, p1 <span class="sc">+</span> z_alpha <span class="sc">*</span> se)</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Two-sample Z-test</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> </span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if the data is valid for both samples</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">check_normality</span>(p1, n1)</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">check_normality</span>(p2, n2)</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the pooled proportion</span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>    pooled_p <span class="ot">&lt;-</span> (p1 <span class="sc">*</span> n1 <span class="sc">+</span> p2 <span class="sc">*</span> n2) <span class="sc">/</span> (n1 <span class="sc">+</span> n2)</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the standard error</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>    se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(pooled_p <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> pooled_p) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">/</span> n1 <span class="sc">+</span> <span class="dv">1</span> <span class="sc">/</span> n2))</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the Z statistic</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>    Z <span class="ot">&lt;-</span> (p1 <span class="sc">-</span> p2) <span class="sc">/</span> se</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the p-value based on the alternative hypothesis</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (alternative <span class="sc">==</span> <span class="st">"two.sided"</span>) </span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>      P <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">abs</span>(Z))  <span class="co"># Two-tailed test</span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (alternative <span class="sc">==</span> <span class="st">"less"</span>) </span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>      P <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(Z)  <span class="co"># Left-tailed test (p1 &lt; p2)</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (alternative <span class="sc">==</span> <span class="st">"greater"</span>) </span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>      P <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span>Z)  <span class="co"># Right-tailed test (p1 &gt; p2)</span></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> </span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">"Invalid alternative hypothesis. Use 'two.sided', 'less', or 'greater'."</span>)</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the confidence interval for the difference in proportions</span></span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>    alpha <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> conf.level</span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>    z_alpha <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>    CI <span class="ot">&lt;-</span> <span class="fu">c</span>((p1 <span class="sc">-</span> p2) <span class="sc">-</span> z_alpha <span class="sc">*</span> se, (p1 <span class="sc">-</span> p2) <span class="sc">+</span> z_alpha <span class="sc">*</span> se)</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the results as a list</span></span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">Z =</span> Z, <span class="at">P =</span> P, <span class="at">CI =</span> CI))</span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>An example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># One-sample test</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>result1 <span class="ot">&lt;-</span> <span class="fu">Z.prop.test</span>(<span class="at">p1 =</span> <span class="fl">0.6</span>, <span class="at">n1 =</span> <span class="dv">100</span>, <span class="at">p0 =</span> <span class="fl">0.5</span>, <span class="at">alternative =</span> <span class="st">"two.sided"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Z
[1] 2

$P
[1] 0.04550026

$CI
[1] 0.5020018 0.6979982</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Two-sample test</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>result2 <span class="ot">&lt;-</span> <span class="fu">Z.prop.test</span>(<span class="at">p1 =</span> <span class="fl">0.6</span>, <span class="at">n1 =</span> <span class="dv">100</span>, <span class="at">p2 =</span> <span class="fl">0.5</span>, <span class="at">n2 =</span> <span class="dv">120</span>, <span class="at">alternative =</span> <span class="st">"greater"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Z
[1] 1.48324

$P
[1] 0.06900537

$CI
[1] -0.03214074  0.23214074</code></pre>
</div>
</div>
<p>Here is the 2nd question:</p>
</section>
<section id="the-dataset-from-kamilar-and-cooper-has-in-it-a-large-number-of-variables-related-to-life-history-and-body-size.-for-this-exercise-the-end-aim-is-to-fit-a-simple-linear-regression-model-to-predict-longevity-maxlongevity_m-measured-in-months-from-species-brain-size-brain_size_species_mean-measured-in-grams.-do-the-following-for-both-longevitybrain-size-and-loglongevitylogbrain-size" class="level3">
<h3 class="anchored" data-anchor-id="the-dataset-from-kamilar-and-cooper-has-in-it-a-large-number-of-variables-related-to-life-history-and-body-size.-for-this-exercise-the-end-aim-is-to-fit-a-simple-linear-regression-model-to-predict-longevity-maxlongevity_m-measured-in-months-from-species-brain-size-brain_size_species_mean-measured-in-grams.-do-the-following-for-both-longevitybrain-size-and-loglongevitylogbrain-size">[2] The dataset from Kamilar and Cooper has in it a large number of variables related to life history and body size. For this exercise, the end aim is to fit a simple linear regression model to predict longevity (<code>MaxLongevity_m</code>) measured in months from species‚Äô brain size (<code>Brain_Size_Species_Mean</code>) measured in grams. Do the following for both <code>longevity~brain size</code> and <code>log(longevity)~log(brain size)</code>:</h3>
<ul>
<li><p>Fit the regression model and, using {ggplot2}, produce a scatterplot with the fitted line superimposed upon the data. Append the the fitted model equation to your plot (HINT: use the function <code>geom_text()</code>).</p></li>
<li><p>Identify and interpret the point estimate of the slope (Œ≤1), as well as the outcome of the test associated with the hypotheses H0: Œ≤1 = 0; HA: Œ≤1 ‚â† 0. Also, find a 90 percent CI for the slope (Œ≤1) parameter.</p></li>
<li><p>Using your model, add lines for the 90 percent confidence and prediction interval bands on the plot and add a legend to differentiate between the lines.</p></li>
<li><p>Produce a point estimate and associated 90 percent PI for the longevity of a species whose brain weight is 800 gm. Do you trust the model to predict observations accurately for this value of the explanatory variable? Why or why not?</p></li>
<li><p>Looking at your two models, which do you think is better? Why?</p></li>
</ul>
</section>
<section id="loading-the-libraries-and-the-data-from-kamilar-and-cooper" class="level3">
<h3 class="anchored" data-anchor-id="loading-the-libraries-and-the-data-from-kamilar-and-cooper">Loading the libraries and the data from Kamilar and Cooper</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading necessary libraries</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)  <span class="co"># For plotting</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)    <span class="co"># For data manipulation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading the dataset</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(curl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using libcurl 8.11.1 with OpenSSL/3.3.2 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">curl</span>(<span class="st">"https://raw.githubusercontent.com/fuzzyatelin/fuzzyatelin.github.io/refs/heads/master/AN588_Spring25/KamilarAndCooperData.csv"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>KC <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(data, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">","</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(KC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Scientific_Name          Family          Genus      Species
1 Allenopithecus_nigroviridis Cercopithecidae Allenopithecus nigroviridis
2         Allocebus_trichotis Cercopithecidae      Allocebus    trichotis
3           Alouatta_belzebul        Atelidae       Alouatta     belzebul
4             Alouatta_caraya        Atelidae       Alouatta       caraya
5            Alouatta_guariba        Atelidae       Alouatta      guariba
6           Alouatta_palliata        Atelidae       Alouatta     palliata
  Brain_Size_Species_Mean Brain_Size_Female_Mean   Brain_size_Ref
1                   58.02                  53.70 Isler et al 2008
2                      NA                     NA                 
3                   52.84                  51.19 Isler et al 2008
4                   52.63                  47.80 Isler et al 2008
5                   51.70                  49.08 Isler et al 2008
6                   49.88                  48.04 Isler et al 2008
  Body_mass_male_mean Body_mass_female_mean Mass_Dimorphism
1                6130                  3180           1.928
2                  92                    84           1.095
3                7270                  5520           1.317
4                6525                  4240           1.539
5                5800                  4550           1.275
6                7150                  5350           1.336
                Mass_Ref MeanGroupSize AdultMales AdultFemale AdultSexRatio
1       Isler et al 2008            NA         NA          NA            NA
2 Smith and Jungers 1997          1.00       1.00         1.0            NA
3       Isler et al 2008          7.00       1.00         1.0          1.00
4       Isler et al 2008          8.00       2.30         3.3          1.43
5       Isler et al 2008          6.53       1.37         2.2          1.61
6       Isler et al 2008         12.00       2.90         6.3          2.17
                                                    Social_Organization_Ref
1                                                                          
2                                                             Kappeler 1997
3                                                       Campbell et al 2007
4 van Schaik et al. 1999; Kappeler and Pereira 2003; Nunn &amp; van Schaik 2000
5                                                       Campbell et al 2007
6 van Schaik et al. 1999; Kappeler and Pereira 2003; Nunn &amp; van Schaik 2000
  InterbirthInterval_d Gestation WeaningAge_d MaxLongevity_m LitterSz
1                   NA        NA       106.15          276.0     1.01
2                   NA        NA           NA             NA     1.00
3                   NA        NA           NA             NA       NA
4               337.62       187       323.16          243.6     1.01
5                   NA        NA           NA             NA       NA
6               684.37       186       495.60          300.0     1.02
   Life_History_Ref GR_MidRangeLat_dd Precip_Mean_mm Temp_Mean_degC AET_Mean_mm
1 Jones et al. 2009             -0.17         1574.0           25.2      1517.8
2                              -16.59         1902.3           20.3      1388.2
3                               -6.80         1643.5           24.9      1286.6
4 Jones et al. 2009            -20.34         1166.4           22.9      1193.1
5                              -21.13         1332.3           19.6      1225.7
6 Jones et al. 2009              6.95         1852.6           23.7      1300.0
  PET_Mean_mm       Climate_Ref HomeRange_km2      HomeRangeRef DayLength_km
1      1589.4 Jones et al. 2009            NA                             NA
2      1653.7 Jones et al. 2009            NA                             NA
3      1549.8 Jones et al. 2009            NA                             NA
4      1404.9 Jones et al. 2009            NA                           0.40
5      1332.2 Jones et al. 2009          0.03 Jones et al. 2009           NA
6      1633.9 Jones et al. 2009          0.19 Jones et al. 2009         0.32
      DayLengthRef Territoriality Fruit Leaves Fauna             DietRef1
1                              NA    NA                                  
2                              NA    NA                                  
3                              NA  57.3   19.1   0.0 Campbell et al. 2007
4 Nunn et al. 2003             NA  23.8   67.7   0.0 Campbell et al. 2007
5                              NA   5.2   73.0   0.0 Campbell et al. 2007
6 Nunn et al. 2003         0.6506  33.1   56.4   0.0 Campbell et al. 2007
  Canine_Dimorphism Canine_Dimorphism_Ref  Feed  Move  Rest Social
1             2.210   Plavcan &amp; Ruff 2008    NA    NA    NA     NA
2                NA                          NA    NA    NA     NA
3             1.811   Plavcan &amp; Ruff 2008 13.75 18.75 57.30  10.00
4             1.542   Plavcan &amp; Ruff 2008 15.90 17.60 61.60   4.90
5             1.783   Plavcan &amp; Ruff 2008 18.33 14.33 64.37   3.00
6             1.703   Plavcan &amp; Ruff 2008 17.94 12.32 66.14   3.64
   Activity_Budget_Ref
1                     
2                     
3 Campbell et al. 2007
4 Campbell et al. 2007
5 Campbell et al. 2007
6 Campbell et al. 2007</code></pre>
</div>
</div>
<p>Now, we will fit the linear regression model into this dataset to predict longevity from brain size:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(MaxLongevity_m <span class="sc">~</span> Brain_Size_Species_Mean, <span class="at">data =</span> KC) <span class="co"># Fit the linear regression model</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model) <span class="co"># Summarize the model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = MaxLongevity_m ~ Brain_Size_Species_Mean, data = KC)

Residuals:
    Min      1Q  Median      3Q     Max 
-198.27  -61.92  -17.78   56.16  331.36 

Coefficients:
                        Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)             248.9523    11.1111   22.41   &lt;2e-16 ***
Brain_Size_Species_Mean   1.2180     0.1101   11.06   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 90.91 on 126 degrees of freedom
  (85 observations deleted due to missingness)
Multiple R-squared:  0.4928,    Adjusted R-squared:  0.4887 
F-statistic: 122.4 on 1 and 126 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Now we will create a scatter plot from fitted line:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a scatterplot with the fitted regression line</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(KC, <span class="fu">aes</span>(<span class="at">x =</span> Brain_Size_Species_Mean, <span class="at">y =</span> MaxLongevity_m)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span>  <span class="co"># Add the data points </span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"green"</span>) <span class="sc">+</span>  <span class="co"># Add the regression line</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_text</span>(</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">aes</span>(</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="at">x =</span> <span class="fu">max</span>(Brain_Size_Species_Mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="fl">0.8</span>, <span class="at">y =</span> <span class="fu">max</span>(MaxLongevity_m, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="fl">0.9</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"y ="</span>, <span class="fu">round</span>(<span class="fu">coef</span>(model)[<span class="dv">1</span>], <span class="dv">2</span>), <span class="st">"+"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(model)[<span class="dv">2</span>], <span class="dv">2</span>), <span class="st">"x"</span>))) <span class="sc">+</span> <span class="co">#Add the equation</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Longevity vs. Brain Size"</span>, <span class="at">x =</span> <span class="st">"Brain Size (g)"</span>, <span class="at">y =</span> <span class="st">"Longevity (months)"</span>) <span class="sc">+</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_text(aes(x = max(Brain_Size_Species_Mean, na.rm = TRUE) * : All aesthetics have length 1, but the data has 213 rows.
‚Ñπ Please consider using `annotate()` or provide this layer with data containing
  a single row.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 85 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 85 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="sghorui_OriginalHomeworkCode_04_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From the model summary, we can interpret the slope and test the hypothesis that the slope is zero.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> <span class="fu">coef</span>(model)[<span class="dv">2</span>]</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>p_value <span class="ot">&lt;-</span> <span class="fu">summary</span>(model)<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">4</span>] <span class="co"># Extracting the slope (Œ≤1) and its p-value</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Slope (Œ≤1):"</span>, slope, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Slope (Œ≤1): 1.21799 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"p-value for H0: Œ≤1 = 0:"</span>, p_value, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>) <span class="co"># Printing the slope and p-value</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>p-value for H0: Œ≤1 = 0: 2.685909e-20 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>conf_int <span class="ot">&lt;-</span> <span class="fu">confint</span>(model, <span class="at">level =</span> <span class="fl">0.90</span>)[<span class="dv">2</span>, ]</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"90% CI for Œ≤1:"</span>, conf_int, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>) <span class="co"># Calculating the 90% confidence interval for the slope</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>90% CI for Œ≤1: 1.035571 1.40041 </code></pre>
</div>
</div>
<p>Now I will add confidence and prediction intervals to the plot and include a legend.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(KC, <span class="fu">aes</span>(<span class="at">x =</span> Brain_Size_Species_Mean, <span class="at">y =</span> MaxLongevity_m)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="co"># Create a plot with both confidence and prediction intervals</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"Confidence Interval"</span>, <span class="at">fill =</span> <span class="st">"Confidence Interval"</span>),<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">level =</span> <span class="fl">0.95</span>) <span class="sc">+</span> <span class="co"># Confidence interval (blue)</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"Prediction Interval"</span>, <span class="at">fill =</span> <span class="st">"Prediction Interval"</span>), <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">level =</span> <span class="fl">0.90</span>) <span class="sc">+</span> <span class="co"># Prediction interval (red)</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_text</span>(</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">max</span>(Brain_Size_Species_Mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="fl">0.8</span>, </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">max</span>(MaxLongevity_m, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="fl">0.9</span>),</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"y ="</span>, <span class="fu">round</span>(<span class="fu">coef</span>(model)[<span class="dv">1</span>], <span class="dv">2</span>), <span class="st">"+"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(model)[<span class="dv">2</span>], <span class="dv">2</span>), <span class="st">"x"</span>), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">4</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> <span class="co"># Regression equation</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Interval Type"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Confidence Interval"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"Prediction Interval"</span> <span class="ot">=</span> <span class="st">"red"</span>)) <span class="sc">+</span> </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Interval Type"</span>,<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Confidence Interval"</span> <span class="ot">=</span> <span class="st">"lightblue"</span>, <span class="st">"Prediction Interval"</span> <span class="ot">=</span> <span class="st">"pink"</span>)) <span class="sc">+</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Longevity vs. Brain Size with Intervals"</span>,<span class="at">x =</span> <span class="st">"Brain Size (g)"</span>, <span class="at">y =</span> <span class="st">"Longevity (months)"</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> <span class="co"># Customizeing colors, legend and adding labels</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)  <span class="co"># Moving legend to bottom</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_text(aes(x = max(Brain_Size_Species_Mean, na.rm = TRUE) * : All aesthetics have length 1, but the data has 213 rows.
‚Ñπ Please consider using `annotate()` or provide this layer with data containing
  a single row.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 85 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 85 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 85 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="sghorui_OriginalHomeworkCode_04_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>And now we will use the model to predict the longevity for a species with a brain size of 800g and calculate the 90% prediction interval.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Brain_Size_Species_Mean =</span> <span class="dv">800</span>) <span class="co"># Creating a new data frame with the brain size of 800g</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> new_data, <span class="at">interval =</span> <span class="st">"prediction"</span>, <span class="at">level =</span> <span class="fl">0.90</span>) <span class="co"># Predicting longevity and calculating the 90% prediction interval</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Predicted Longevity for 800g Brain Size:"</span>, prediction[<span class="dv">1</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Predicted Longevity for 800g Brain Size: 1223.345 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"90% Prediction Interval:"</span>, prediction[<span class="dv">2</span>], <span class="st">"to"</span>, prediction[<span class="dv">3</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>) <span class="co"># Printing the prediction and interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>90% Prediction Interval: 1021.805 to 1424.884 </code></pre>
</div>
</div>
<p>We‚Äôll repeat the process using the log-transformed variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>log_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(MaxLongevity_m) <span class="sc">~</span> <span class="fu">log</span>(Brain_Size_Species_Mean), <span class="at">data =</span> KC) <span class="co"># Fitting the log-transformed model</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(log_model) <span class="co"># Summarizing the log-transformed model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(MaxLongevity_m) ~ log(Brain_Size_Species_Mean), 
    data = KC)

Residuals:
    Min      1Q  Median      3Q     Max 
-0.6955 -0.1750 -0.0097  0.1788  0.6084 

Coefficients:
                             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                   4.87895    0.06907   70.63   &lt;2e-16 ***
log(Brain_Size_Species_Mean)  0.23415    0.01781   13.15   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2485 on 126 degrees of freedom
  (85 observations deleted due to missingness)
Multiple R-squared:  0.5784,    Adjusted R-squared:  0.5751 
F-statistic: 172.9 on 1 and 126 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a scatterplot with the fitted line for the log-transformed model</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(KC, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(Brain_Size_Species_Mean), <span class="at">y =</span> <span class="fu">log</span>(MaxLongevity_m))) <span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">max</span>(<span class="fu">log</span>(Brain_Size_Species_Mean)) <span class="sc">*</span> <span class="fl">0.8</span>, <span class="at">y =</span> <span class="fu">max</span>(<span class="fu">log</span>(MaxLongevity_m)) <span class="sc">*</span> <span class="fl">0.9</span>), <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"y ="</span>, <span class="fu">round</span>(<span class="fu">coef</span>(log_model)[<span class="dv">1</span>], <span class="dv">2</span>), <span class="st">"+"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(log_model)[<span class="dv">2</span>], <span class="dv">2</span>), <span class="st">"x"</span>)) <span class="sc">+</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Log(Longevity) vs. Log(Brain Size)"</span>, <span class="at">x =</span> <span class="st">"Log(Brain Size)"</span>, <span class="at">y =</span> <span class="st">"Log(Longevity)"</span>) <span class="sc">+</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_text(aes(x = max(log(Brain_Size_Species_Mean)) * 0.8, y = max(log(MaxLongevity_m)) * : All aesthetics have length 1, but the data has 213 rows.
‚Ñπ Please consider using `annotate()` or provide this layer with data containing
  a single row.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 85 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 85 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 213 rows containing missing values or values outside the scale range
(`geom_text()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="sghorui_OriginalHomeworkCode_04_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Finally, we‚Äôll compare the two models to determine which one is better.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"R-squared for original model:"</span>, <span class="fu">summary</span>(model)<span class="sc">$</span>r.squared, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R-squared for original model: 0.4927693 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"R-squared for log-transformed model:"</span>, <span class="fu">summary</span>(log_model)<span class="sc">$</span>r.squared, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R-squared for log-transformed model: 0.5784088 </code></pre>
</div>
</div>
<p>The <strong>log-transformed model is better</strong> because it fits the data better (higher R¬≤), handles biological scaling more effectively, and provides clearer interpretations of the brain size-longevity relationship. It‚Äôs especially useful for data with wide ranges like primate species.</p>
<p>Here are 5 coding headaches I ran into while working on this analysis:</p>
<ol type="1">
<li><p>Kept getting errors because some species had NA values for brain size or longevity. Had to do detective work with is.na() and decide whether to drop rows or impute values.</p></li>
<li><p>Forgot that you can‚Äôt take log(0) or log(negative numbers)! Had to double-check my data and make sure all values were positive before transforming.</p></li>
<li><p>Spent way too long fighting with geom_text() to make the regression equation display nicely on the plots. Positioning the text just right was surprisingly fiddly.</p></li>
<li><p>At first my prediction intervals looked ridiculously wide until I realized I was using confidence intervals (interval=‚Äúconfidence‚Äù) instead of prediction intervals (interval=‚Äúprediction‚Äù). D‚Äôoh!</p></li>
<li><p>Kept mixing up which model was which when comparing R¬≤ values. Had to create separate clearly-named objects (model vs log_model) to stay organized.</p></li>
</ol>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>
